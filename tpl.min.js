var tpl={html:function(a,b){return this.func(a)(b)},func:function(a){var b=this.compile(a);return new Function("tplData","var _h='';function _w(s){ _h+=s;}"+b+"return _h;")},compile:function(a){function b(a){return"_w('"+a.replace(/'/g,"\\'").replace(/@(\{.+?\}|[\w\.\[\]\(\)]+)/g,function(a,b,d,e){if(b=b.replace(/\\'/g,"'"),"\\"==e.charAt(d-1))return"@"+b;if("{"==b.charAt(0)&&(b=b.substr(1,b.length-2)),"."==b.charAt(0))return"'+("+c+b+")+'";var d=b.lastIndexOf(".");return d>0&&(c=b.substring(0,d)),"'+("+b+")+'"})+"');"}for(var h,i,c="item",d="",e=a.split("\n"),f=e.length,g=-1;++g<f;)i=e[g],i=i.replace(/^\s*((?:[\S\s]*\S)?)\s*$/,"$1"),h=i.charAt(0),d+="<"==h||"@"==h?b(i):"!"==h&&"!"==i.charAt(1)?"_w('"+i.substr(2)+"');":"!"==h?b(i.substr(1)):i;return d},getJSON:function(url,callback){var req=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=function(){if(4==req.readyState&&200==req.status){var json=eval("("+req.responseText+")");callback(json)}};try{req.open("GET",url,!0),req.send()}catch(e){}},render:function(){function h(a,b){var c=a.parentNode,d=e.childNodes;for(e.innerHTML=tpl.func(a.innerHTML)(b);0!=d.length;)c.insertBefore(d[0],a);c.removeChild(a)}var d,f,e,i,a=document.getElementsByTagName("script"),b=[],c=a.length;for(d=0;c>d;d++)"tpl"==a[d].getAttribute("type")&&null===a[d].getAttribute("norender")&&b.push(a[d]);for(e=document.createElement("div"),c=b.length,d=0;c>d;d++)f=b[d],i=f.getAttribute("data"),i?function(a){tpl.getJSON(i,function(b){h(a,b)})}(f):h(f)}};